

#config max9296 MIPI output disable
i2ctransfer -f -y 0 w3@0x40 0x03 0x13 0x00
#select linkA
i2ctransfer -f -y 0 w3@0x40 0x00 0x10 0x21
usleep 100000

#GMSL-A Serializer Address Change from 0x80 to 0x84
#(DEV_ADDR): 0x41
i2ctransfer -f -y 0 w3@0x40 0x00 0x00 0x82
i2ctransfer -f -y 0 w3@0x41 0x00 0x7B 0x31
i2ctransfer -f -y 0 w3@0x41 0x00 0x83 0x31
i2ctransfer -f -y 0 w3@0x41 0x00 0x8B 0x31
i2ctransfer -f -y 0 w3@0x41 0x00 0x93 0x31
i2ctransfer -f -y 0 w3@0x41 0x00 0xA3 0x31
i2ctransfer -f -y 0 w3@0x41 0x00 0xAB 0x31

# set 2 lanes
i2ctransfer -f -y 0 w3@0x41 0x03 0x31 0x10

# linkA+linkB
i2ctransfer -f -y 0 w3@0x4a 0x00 0x10 0x23
usleep 100000

#//////////////////link A MAX9295A  0x84  /////////////////////
#RAW12
i2ctransfer -f -y 0 w3@0x41 0x03 0x18 0x6C
i2ctransfer -f -y 0 w3@0x41 0x00 0x57 0x12
i2ctransfer -f -y 0 w3@0x41 0x00 0x5b 0x11
# New Sensor address for LinkA
i2ctransfer -f -y 0 w3@0x41 0x00 0x44 0x22
# Broadcast address for Sensor
i2ctransfer -f -y 0 w3@0x41 0x00 0x45 0x20



#//////////////////link b MAX9295A 0x80  /////////////////////
i2ctransfer -f -y 0 w3@0x40 0x00 0x00 0x84
# set 2 lanes
i2ctransfer -f -y 0 w3@0x42 0x03 0x31 0x10
#RAW12
i2ctransfer -f -y 0 w3@0x42 0x03 0x18 0x6C
#ID=2
i2ctransfer -f -y 0 w3@0x42 0x00 0x5b 0x12
# New Sensor address for LinkA
i2ctransfer -f -y 0 w3@0x42 0x00 0x44 0x24
# Broadcast address for Sensor
i2ctransfer -f -y 0 w3@0x42 0x00 0x45 0x20

#// ---------------- MAX9296A MIPI deserializer setup ---------------------//
#set portA to 1*4 mode
i2ctransfer -f -y 0 w3@0x4a 0x03 0x30 0x04
#set portA to 4 mode
i2ctransfer -f -y 0 w3@0x4a 0x04 0x4A 0xD0
#set portB to 4 mode
i2ctransfer -f -y 0 w3@0x4a 0x04 0x8A 0xD0
i2ctransfer -f -y 0 w3@0x4a 0x03 0x25 0x80

# Set MIPI data rate = 1500Mbps/lane
# mipi phy1 clock==1500Mhz
i2ctransfer -f -y 0 w3@0x4a 0x03 0x20 0x2F
# mipi phy2 clock==1500Mhz
i2ctransfer -f -y 0 w3@0x4a 0x03 0x23 0x2F



# Send YUV8, FS, and FE from Pipe Y to Controller 1
# Enable 3 Mappings
i2ctransfer -f -y 0 w3@0x4a 0x04 0x4B 0x07
# Destionation Controller = Controller 1. Controller 1 sends data to MIPI Port A
i2ctransfer -f -y 0 w3@0x4a 0x04 0x6D 0x15

# For the following MSB 2 bits = VC, LSB 6 bits =DT
# SRC  DT = YUV8
i2ctransfer -f -y 0 w3@0x4a 0x04 0x4D 0x2C
# DEST DT = YUV8 and VC = 01
i2ctransfer -f -y 0 w3@0x4a 0x04 0x4E 0x2C
# SRC  DT = Frame Start
i2ctransfer -f -y 0 w3@0x4a 0x04 0x4F 0x00
# DEST DT = Frame Start
i2ctransfer -f -y 0 w3@0x4a 0x04 0x50 0x00
# SRC  DT = Frame End
i2ctransfer -f -y 0 w3@0x4a 0x04 0x51 0x01
# DEST DT = Frame End
i2ctransfer -f -y 0 w3@0x4a 0x04 0x52 0x01

# Send YUV8, FS, and FE from Pipe Z to Controller 1
# Enable 3 Mappings
i2ctransfer -f -y 0 w3@0x4a 0x04 0x8B 0x07
# Destionation Controller = Controller 1. Controller 1 sends data to MIPI Port A
i2ctransfer -f -y 0 w3@0x4a 0x04 0xAD 0x15

# For the following MSB 2 bits = VC, LSB 6 bits =DT
# SRC  DT = YUV8
i2ctransfer -f -y 0 w3@0x4a 0x04 0x8D 0x2C
# DEST DT = YUV8 and VC = 01
i2ctransfer -f -y 0 w3@0x4a 0x04 0x8E 0x2C
# SRC  DT = Frame Start
i2ctransfer -f -y 0 w3@0x4a 0x04 0x8F 0x00
# DEST DT = Frame Start
i2ctransfer -f -y 0 w3@0x4a 0x04 0x90 0x40
# SRC  DT = Frame End
i2ctransfer -f -y 0 w3@0x4a 0x04 0x91 0x01
# DEST DT = Frame End
i2ctransfer -f -y 0 w3@0x4a 0x04 0x92 0x41

#	//////////////////link A IMX390 INI  /////////////////////
#	//////////////////link B IMX390 INI  /////////////////////

#mipi output enable
usleep 100000
i2ctransfer -f -y 0 w3@0x4a 0x03 0x13 0x02

